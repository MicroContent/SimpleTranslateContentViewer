<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>SimpleTranslateContentViewer</title>
    <script type="application/javascript">
        /** 
            dont delete! 
        **/
        function init() {
            window.data = getData();
            setXapiObjectGetter(getXapiObject);
            registerOnSubmitListener(onSubmit);
        }
        /** 
            dont delete! 
        **/
        function updateLayout() {
            propagateLayoutChanges();
        }
        /** 
            dont delete! 
        **/
        function sendStatement(stmt) {
            sendXapiStatement(stmt);
        }
    </script>

    <!-- EDIT css for custom styling 
         
        NOTE: you can use Material-css classes for styling 
        Source: https://fezvrasta.github.io/bootstrap-material-design/docs/4.0/getting-started/introduction/
    -->
     <style type ="text/css">
     </style>
    <!-- EDIT css for custom styling -->

</head>
<body>    

    <h1 id="title"></h1>
    <div id="question"></div>
    <div id="instructions"></div>
    <div id="answer"><input class="form-control" id="answerInput" onkeyup="onInteraction()" type="text" /></div>
    <div id="solution"></div>

    <script type="application/javascript">
        function setContent(){
            document.getElementById('question').innerHTML = data.question;
            document.getElementById('instructions').innerHTML = data.instructions;
            document.getElementById('solution').innerHTML = window.data.answers.join(" oder ");
        }
        
        function getXapiObject(){
            return {
                "definition": {
                    "description": {
                        "en-US": window.data.instructions + ": " + window.data.question
                    },
                    "type": "http://adlnet.gov/expapi/activities/cmi.interaction",
                    "interactionType": "long-fill-in",
                    "correctResponsesPattern": 
                        window.data.answers.join("[,]")
                }
            }
        }

        
        function onInteraction(){
            var stmt = {};
                // actor is set by hosting application
            stmt.actor = undefined;
            stmt.verb = {
                "id": "http://adlnet.gov/expapi/verbs/interacted",
                "display": {
                    "de-DE": "interagierte",
                    "en-US": "interacted",
                    "fr-FR": "a interagi",
                    "es-ES": "interactuó"
                }
            };
            stmt.object = getXapiObject();
            stmt.result = {
                response: document.getElementById("answerInput").value
            };
            sendStatement(stmt);
        }

        function onSubmit(){
            if (isShowingSolution) {
                isShowingSolution = false;
            }
            else {
                // Build an send Statement
                var stmt = {};
                stmt.actor = undefined; // actor is set by hosting application
                stmt.verb = {
                    "id": "http://adlnet.gov/expapi/verbs/answered",
                    "display": {
                        "de-DE": "beantwortete",
                        "en-US": "answered",
                        "fr-FR": "a répondu",
                        "es-ES": "contestó"
                    }
                };
                stmt.object = getXapiObject();
                stmt.result = {
                    response: document.getElementById("answerInput").value,
                    success: checkIfCurrentAnswerCorrect()
                };
                sendStatement(stmt);
                
                // set ShowingSolutionState
                isShowingSolution = true;
            }
        }

        function checkIfCurrentAnswerCorrect() {
            for (var i = 0; i < window.data.answers.length; i++) {
                if (window.data.answers[i] === document.getElementById("answerInput").value) return true;
            }
            return false;
        }
        
        init();

        var isShowingSolution = false;

        setContent();
        updateLayout();

        /**@argument

        {
        "title": "Liebesbezeichnungen",
        "answers": [
            "Ich liebe SOIL",
            "Ich mag SOIL"
        ],
        "question": "I love SOIL",
        "instructions": "Übersetze den Satz von English nach Deutsch",
        "description": "Übersetze den Satz von English nach Deutsch: \"I Love SOIL\""
        }

        **/

    </script>
    <!-- EDIT card logic -->

</body>
</html>
